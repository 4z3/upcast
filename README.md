```console
upcast - infrastructure orchestratrion

Usage: upcast COMMAND

Available commands:
  go                       execute a deployment
  test                     deployment dry-run
  info                     print deployment resource information in json format
  ssh-config               print ssh config for deployment (evaluates resources)
```

### Quick start

```console
$ awk 'NR==1{print "default", $1, $2}' ~/.ec2-keys > ~/.aws-keys
$ cabal install
$ export UPCAST_NIX_FLAGS="--option use-binary-cache true --option binary-caches http://hydra.nixos.org --option use-ssh-substituter true --option ssh-substituter-hosts me@node1.example.com"
$ upcast go test.nix -- -I sources/nixpkgs
```

### Goals

- simplicity, extensibility;
- minimum dependency of network latency of the client;
- shared state stored as nix expressions next to machines expressions;
- first-class AWS support (including AWS features nixops doesn't have), as a side-effect, deliver a command-line ec2 toolchain;
- support for running day-to-day operations on deployed resources, services and machines.

### Notable differences from NixOps

#### Expression files

- You can no longer specify the machine environment using `deployment.targetEnv`, now you need to explicitly include the resource module instead.
  Currently available modules are: `<upcast/env-ec2.nix>`.

#### Operation modes

- The only supported command is `deploy` (so far). No `create`, `modify`, `clone`, `set-args`, `send-keys` non-sense;
- NixOps SQLite state files are abandoned, separate text files ([json dict for state](https://github.com/zalora/upcast/blob/master/src/Upcast/TermSubstitution.hs) and a private key file) are used instead;
- Physical specs are removed;
- Identical machines get identical machine closures, they are no longer parametric by things like hostnames (these are configured at runtime).

#### Resources

- New: EC2-VPC support, ELB support;
- Additionally planned: AWS autoscaling, host-independent machine closures, EBS snapshotting;
- Different in EC2: CreateKeyPair (autogenerated private keys by amazon) is not supported, ImportKeyPair is used instead;
- Not supported: ec2-classic (non-VPC), route53, sqs, s3, elastic ips, iam roles, ssh tunnels, adhoc nixos deployments,
                 deployments to expressions that span multiple AWS regions;
- Most likely will not be supported: virtualbox, hetzner, auto-luks, auto-raid0, `/run/keys` support, static route53 support (like nixops);



### Motivation

![motivation](http://i.imgur.com/HY2Gtk5.png)

### Hacking

Initially developed with GHC 7.8.2 and Cabal 1.20 localhost-style. YMMV.
