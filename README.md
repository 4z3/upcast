## upcast

Next generation cloud deployment tool, replacement for NixOps.

### Motivation

![motivation](http://i.imgur.com/HY2Gtk5.png)

### Goals

- simplicity, extensibility;
- minimum dependency of network latency of the client;
- shared state stored as nix expressions next to machines expressions;
- first-class AWS support (including AWS features nixops doesn't have), as a side-effect, deliver a command-line ec2 toolchain;
- support for running day-to-day operations on deployed resources, services and machines.

### Notable differences from NixOps

#### Operation modes

- The only supported command is `deploy` (so far). No `create`, `modify`, `clone`, `set-args`, `send-keys` non-sense.
- NixOps SQLite state files are abandoned, separate text files ([json dict for state](https://github.com/zalora/upcast/blob/master/src/Upcast/TermSubstitution.hs) and a private key file) are used instead.

#### Resources

- New: EC2-VPC support, ELB support;
- Additionally planned: AWS autoscaling, host-independent machine closures (deprecation of physical specs), EBS snapshotting;
- Different in EC2: CreateKeyPair (autogenerated private keys by amazon) is not supported, ImportKeyPair is used instead;
- Not supported: ec2-classic (non-VPC), route53, sqs, s3, elastic ips, iam roles, ssh tunnels, adhoc nixos deployments,
                 deployments to expressions that span multiple AWS regions;
- Most likely will not be supported: virtualbox, hetzner, auto-luks, auto-raid0, `/run/keys` support, static route53 support (like nixops);



### Running

```
$ awk 'NR==1{print "default", $1, $2}' ~/.ec2-keys > ~/.aws-keys
$ cabal configure -O2
$ cabal install
$ upcast ~/eris/sg-staging.nix
```

NB: Initially developed with GHC 7.8.2 and Cabal 1.20 localhost-style. YMMV.

